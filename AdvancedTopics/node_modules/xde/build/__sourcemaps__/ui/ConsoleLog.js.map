{"version":3,"sources":["ui/ConsoleLog.js"],"names":["ConsoleLog","Component","componentWillReceiveProps","nextProps","oldIsLoading","props","isLoading","newIsLoading","_grid","requestAnimationFrame","_cellMeasurer","resetMeasurements","recomputeGridSize","_logHasPadding","index","log","logs","tag","type","_lastLogHasPadding","_renderLog","rowIndex","length","_renderLoading","message","msg","logStyle","Styles","logDefault","LOG_LEVEL_TO_STYLE","level","time","toLocaleTimeString","shouldLinkify","trim","paddingTop","paddingBottom","gutterLg","INFO","logDebug","includes","paddingLeft","groupDepth","otherStyles","bigLog","logContainer","logTime","componentWillUpdate","node","_scrollContainerRef","shouldScrollBottom","scrollTop","offsetHeight","scrollHeight","componentDidUpdate","loadingIndicator","red","green","blue","alpha","render","numRows","bottomBarLeftContent","bottomBarRightContent","container","c","range","map","bottomBar","bottomBarLeft","bottomBarRight","clearButtonLink","onClickClearLogs","clearButton","propTypes","bool","arrayOf","object","func","display","flexDirection","height","background","colorDarkBackground","fontSize","fontSizeMd","overflowY","padding","flex","whiteSpace","fontSizeLg","color","colorDebug","logWarning","colorWarning","logError","colorError","fontSizeSm","colorSubtitle","width","minWidth","alignItems","justifyContent","textAlign","paddingRight","marginVertical","gutterSm","cursor","colorText","textDecoration","verticalAlign","maxHeight","maxWidth","margin","DEBUG","WARN","ERROR"],"mappings":"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","file":"../../ui/ConsoleLog.js","sourcesContent":["import _ from 'lodash';\nimport bunyan from 'bunyan';\nimport LoadingIndicator from 'react-loading-indicator';\nimport React, {PropTypes} from 'react';\nimport Linkify from 'react-linkify';\n\nimport StyleConstants from './StyleConstants';\n\nexport default class ConsoleLog extends React.Component {\n  static propTypes = {\n    isLoading: PropTypes.bool,\n    logs: PropTypes.arrayOf(PropTypes.object),\n    bottomBarLeftContent: PropTypes.node,\n    bottomBarRightContent: PropTypes.node,\n    onClickClearLogs: PropTypes.func,\n  };\n\n  componentWillUpdate() {\n    // Don't keep scrolling down, unless already scrolled to bottom.\n    // From http://blog.vjeux.com/2013/javascript/scroll-position-with-react.html\n    const node = this._scrollContainerRef;\n    if (node) {\n      this.shouldScrollBottom = node.scrollTop + node.offsetHeight === node.scrollHeight;\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.shouldScrollBottom) {\n      const node = this._scrollContainerRef;\n      if (node) {\n        node.scrollTop = node.scrollHeight;\n      }\n    }\n  }\n\n  componentWillReceiveProps = (nextProps) => {\n    // When the loading indicator appears or is hidden, force a redraw.\n    let oldIsLoading = this.props.isLoading;\n    let newIsLoading = nextProps.isLoading;\n    if (oldIsLoading !== newIsLoading && this._grid) {\n      requestAnimationFrame(() => {\n        this._cellMeasurer.resetMeasurements();\n        this._grid.recomputeGridSize();\n      });\n    }\n  }\n\n  _logHasPadding = (index) => {\n    let log = this.props.logs[index];\n    return log.tag === 'exponent' || log.type === 'global' || log.type === 'notifications';\n  }\n\n  _lastLogHasPadding = (index) => {\n    if (index === 0) {\n      return false;\n    } else {\n      return this._logHasPadding(index - 1);\n    }\n  }\n\n  _renderLog = ({ rowIndex }) => {\n    let index = rowIndex;\n    if (index >= this.props.logs.length) {\n      return this._renderLoading();\n    }\n\n    let log = this.props.logs[index];\n    let message = log.msg;\n    let logStyle = Styles.logDefault;\n    if (LOG_LEVEL_TO_STYLE[log.level]) {\n      logStyle = LOG_LEVEL_TO_STYLE[log.level];\n    }\n\n    let time = log.time.toLocaleTimeString();\n    let shouldLinkify = true;\n\n    message = _.trim(message);\n\n    // Give important messages more space\n    let paddingTop = 0;\n    let paddingBottom = 0;\n    if (log.tag === 'exponent' || log.type === 'global' || log.type === 'notifications') {\n      paddingBottom = 20;\n      if (index > 0 && !this._lastLogHasPadding(index)) {\n        paddingTop = 20;\n      }\n    }\n\n    if (index === 0) {\n      paddingTop = StyleConstants.gutterLg;\n    }\n\n    // Lower priority of packager logs\n    if (log.tag === 'packager' && log.level === bunyan.INFO) {\n      logStyle = Styles.logDebug;\n    }\n\n    // A big chunk of json is logged right when an app starts. Lower the priority.\n    if (log.tag === 'device' && message.includes('Running application') && message.includes('with appParams')) {\n      logStyle = Styles.logDebug;\n      // Linkify does a bad job parsing json, so ingore this.\n      shouldLinkify = false;\n    }\n\n    // console.group\n    let paddingLeft = 0;\n    if (log.groupDepth) {\n      paddingLeft = log.groupDepth * 20;\n    }\n\n    let otherStyles = {};\n    if (message.includes('Project opened!')) {\n      otherStyles = Styles.bigLog;\n    }\n\n    return (\n      <div key={index} style={{...Styles.logContainer, paddingTop, paddingBottom}}>\n        <span style={Styles.logTime}>{time}</span>\n        <pre style={{...Styles.log, ...logStyle, paddingLeft, ...otherStyles}}>\n          {shouldLinkify ?\n            <Linkify>\n              {message}\n            </Linkify> :\n            message\n          }\n        </pre>\n      </div>\n    );\n  }\n\n  _renderLoading() {\n    let { isLoading } = this.props;\n\n    if (isLoading) {\n      return (\n        <div style={Styles.loadingIndicator} key={-1}>\n          <LoadingIndicator color={{red: 255, green: 255, blue: 255, alpha: 1}} />\n        </div>\n      );\n    } else {\n      return (\n        <div key={-2} />\n      );\n    }\n  }\n\n  render() {\n    // add extra row for loading container\n    let numRows = this.props.logs.length + 1;\n\n    let { bottomBarLeftContent, bottomBarRightContent } = this.props;\n    if (!bottomBarLeftContent) {\n      bottomBarLeftContent = (<div />);\n    }\n    if (!bottomBarRightContent) {\n      bottomBarRightContent = (<div />);\n    }\n\n    /* eslint-disable react/jsx-no-bind */\n    return (\n      <div style={Styles.container}>\n        <div\n          style={Styles.logs}\n          ref={(c) => { this._scrollContainerRef = c; }}>\n          {_.range(numRows).map(rowIndex => this._renderLog({rowIndex}))}\n        </div>\n        <div style={Styles.bottomBar}>\n          <div style={Styles.bottomBarLeft}>\n            {bottomBarLeftContent}\n          </div>\n          <div style={Styles.bottomBarRight}>\n            <a style={Styles.clearButtonLink} onClick={this.props.onClickClearLogs}>\n              <img src=\"./IconClear.png\" style={Styles.clearButton} />\n            </a>\n            {bottomBarRightContent}\n          </div>\n        </div>\n      </div>\n    );\n    /* eslint-enable react/jsx-no-bind */\n  }\n}\n\nconst Styles = {\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  logs: {\n    background: StyleConstants.colorDarkBackground,\n    fontSize: StyleConstants.fontSizeMd,\n    height: '100%',\n    overflowY: 'auto',\n    padding: StyleConstants.gutterLg,\n    flex: '1',\n  },\n  logContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n  },\n  log: {\n    background: StyleConstants.colorDarkBackground,\n    whiteSpace: 'pre-wrap',\n  },\n  bigLog: {\n    fontSize: StyleConstants.fontSizeLg,\n  },\n  logDebug: {\n    color: StyleConstants.colorDebug,\n  },\n  logDefault: {\n    color: 'white',\n  },\n  logWarning: {\n    color: StyleConstants.colorWarning,\n  },\n  logError: {\n    color: StyleConstants.colorError,\n  },\n  logTime: {\n    fontSize: StyleConstants.fontSizeSm,\n    color: StyleConstants.colorSubtitle,\n    width: 85,\n    minWidth: 85,\n  },\n  loadingIndicator: {\n    paddingLeft: StyleConstants.gutterLg,\n    paddingTop: StyleConstants.gutterLg,\n  },\n  bottomBar: {\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    height: 24,\n    display: 'flex',\n  },\n  bottomBarLeft: {\n    flex: 1,\n  },\n  bottomBarRight: {\n    flex: 1,\n    textAlign: 'right',\n    paddingRight: StyleConstants.gutterLg,\n    marginVertical: StyleConstants.gutterSm,\n  },\n  clearButtonLink: {\n    cursor: 'pointer',\n    fontSize: StyleConstants.fontSizeSm,\n    color: StyleConstants.colorText,\n    textDecoration: 'none',\n    display: 'inline-flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    verticalAlign: 'middle',\n  },\n  clearButton: {\n    maxHeight: 10,\n    maxWidth: 10,\n    margin: 6,\n  },\n};\n\nconst LOG_LEVEL_TO_STYLE = {\n  [bunyan.DEBUG]: Styles.logDebug,\n  [bunyan.INFO]: Styles.logDefault,\n  [bunyan.WARN]: Styles.logWarning,\n  [bunyan.ERROR]: Styles.logError,\n};\n"]}